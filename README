apps/
â””â”€ webapp/
   â”œâ”€ public/
   â”‚   â””â”€ favicon.svg
   â”œâ”€ src/
   â”‚  â”œâ”€ assets/
   â”‚  â”‚   â””â”€ react.svg
   â”‚  â”œâ”€ components/
   â”‚  â”‚  â”œâ”€ layout/
   â”‚  â”‚  â”‚   â”œâ”€ TopBar.tsx            # page title + optional actions
   â”‚  â”‚  â”‚   â”œâ”€ NavBar.tsx            # bottom tabs: Shop | Cart | Orders | Profile (+ Admin if admin)
   â”‚  â”‚  â”‚   â””â”€ StatusBar.tsx         # slim status/notice bar (optional)
   â”‚  â”‚  â”œâ”€ common/
   â”‚  â”‚  â”‚   â”œâ”€ Loader.tsx            # spinner/skeleton
   â”‚  â”‚  â”‚   â”œâ”€ ErrorView.tsx         # friendly error box
   â”‚  â”‚  â”‚   â”œâ”€ EmptyState.tsx        # â€œnothing here yetâ€ placeholder
   â”‚  â”‚  â”‚   â”œâ”€ Pagination.tsx        # prev/next + page indicator
   â”‚  â”‚  â”‚   â”œâ”€ QuantityStepper.tsx   # âˆ’ qty + control
   â”‚  â”‚  â”‚   â”œâ”€ Badge.tsx             # small status label (pending/paid/etc.)
   â”‚  â”‚  â”‚   â””â”€ FormField.tsx         # label + input/textarea wrapper
   â”‚  â”‚  â”œâ”€ product/
   â”‚  â”‚  â”‚   â”œâ”€ ProductCard.tsx       # image, title, price, stock, Add to cart
   â”‚  â”‚  â”‚   â”œâ”€ ProductGrid.tsx       # responsive grid of ProductCard
   â”‚  â”‚  â”‚   â””â”€ CategoryTabs.tsx      # scrollable category pills (active state)
   â”‚  â”‚  â”œâ”€ cart/
   â”‚  â”‚  â”‚   â”œâ”€ CartItemRow.tsx       # title, price, QuantityStepper, remove
   â”‚  â”‚  â”‚   â””â”€ CartSummary.tsx       # total + checkout CTA
   â”‚  â”‚  â”œâ”€ orders/
   â”‚  â”‚  â”‚   â”œâ”€ OrderListItem.tsx     # #id, date, total, status
   â”‚  â”‚  â”‚   â””â”€ OrderSummary.tsx      # items + totals used on detail page
   â”‚  â”‚  â””â”€ profile/
   â”‚  â”‚      â””â”€ AddressForm.tsx       # city, place, specialReference (reused in cart/profile)
   â”‚  â”‚
   â”‚  â”œâ”€ routes/
   â”‚  â”‚  â”œâ”€ Home.tsx                  # Shop landing: CategoryTabs + ProductGrid (+ Pagination)
   â”‚  â”‚  â”œâ”€ Products.tsx              # (optional) products for a specific category via ?category=
   â”‚  â”‚  â”œâ”€ Categories.tsx            # category list (if you want a separate view)
   â”‚  â”‚  â”œâ”€ Cart.tsx                  # cart list using CartItemRow + CartSummary + AddressForm
   â”‚  â”‚  â”œâ”€ Profile.tsx               # shows user info + AddressForm (save to /api/profile)
   â”‚  â”‚  â”œâ”€ Orders.tsx                # list of orders using OrderListItem
   â”‚  â”‚  â””â”€ OrderDetail.tsx           # single order view using OrderSummary
   â”‚  â”‚  # (later) Admin/
   â”‚  â”‚  #   â”œâ”€ Products.tsx          # admin products table
   â”‚  â”‚  #   â””â”€ ProductForm.tsx       # create/edit product
   â”‚  â”‚
   â”‚  â”œâ”€ lib/
   â”‚  â”‚  â”œâ”€ api/
   â”‚  â”‚  â”‚   â”œâ”€ catalog.ts            # GET /categories, GET /products?category=&page=&perPage=
   â”‚  â”‚  â”‚   â”œâ”€ cart.ts               # GET /cart, POST /cart/items, PATCH/DELETE /cart/items/:id
   â”‚  â”‚  â”‚   â”œâ”€ orders.ts             # GET /orders, GET /orders/:id, POST /checkout
   â”‚  â”‚  â”‚   â”œâ”€ profile.ts            # GET/PUT /profile
   â”‚  â”‚  â”‚   â””â”€ index.ts              # re-export + api base (adds X-Telegram-Init-Data header)
   â”‚  â”‚  â”œâ”€ hooks/
   â”‚  â”‚  â”‚   â”œâ”€ useAsync.ts           # loading/data/error helper
   â”‚  â”‚  â”‚   â””â”€ useQueryParam.ts      # read/write ?page, ?category, etc.
   â”‚  â”‚  â”œâ”€ types.ts                  # Category, Product, Cart, Order, Profile interfaces
   â”‚  â”‚  â”œâ”€ format.ts                 # money/date helpers (Intl wrappers)
   â”‚  â”‚  â”œâ”€ store.ts                  # lightweight global state (cart badge count, user hint)
   â”‚  â”‚  â”œâ”€ telegram.ts               # WebApp init + theme + initData extraction
   â”‚  â”‚  â””â”€ constants.ts              # perPage defaults, route paths, etc.
   â”‚  â”‚
   â”‚  â”œâ”€ App.tsx                      # route switcher + TopBar/NavBar glue
   â”‚  â”œâ”€ main.tsx                     # React entry (Vite)
   â”‚  â”œâ”€ index.css                    # global reset + Telegram theme variables
   â”‚  â””â”€ App.css                      # component-level styles (if needed)
   â”‚
   â”œâ”€ .env.example                    # FRONTEND_API_BASE, etc. (if you proxy, may be empty)
   â”œâ”€ index.html
   â”œâ”€ package.json
   â”œâ”€ tsconfig.app.json
   â”œâ”€ tsconfig.json
   â”œâ”€ tsconfig.node.json
   â””â”€ vite.config.ts


How To run

First run this
# --- Write a clean v3 config to the path you want ---
$cfg = @"
version: 3
agent:
  authtoken: 31Se6p0GGBw7fuNqBdHVfrUvHzD_4bWdUQBXhiqeokL3d8WvV

tunnels:
  backend:
    proto: http
    addr: 4000
  webapp:
    proto: http
    addr: 5173
"@

$cfg | Set-Content -Encoding UTF8 'C:\Users\davet\AppData\Local\ngrok\ngrok.yml'

# --- Force this process to use your file and a valid update channel ---
$env:NGROK_CONFIG = 'C:\Users\davet\AppData\Local\ngrok\ngrok.yml'
$env:NGROK_UPDATE_CHANNEL = 'stable'

# --- Sanity check the file content weâ€™ll use ---
Get-Content -Raw $env:NGROK_CONFIG

# --- Validate and start (explicit --config just to be extra safe) ---
ngrok config check --config $env:NGROK_CONFIG

ngrok start backend webapp --config $env:NGROK_CONFIG


copy the fron and back of ngrock and update 



pnpm dev          # run with ts-node + nodemon
pnpm db:studio    # GUI to inspect DB
ngrok http 4000


npx prisma migrate dev -n add_photo_to_product_fields
pnpm prisma db push 
pnpm prisma generate

 pnpm run dev



 auth/security and UI/functional features).


ğŸ›ï¸ TG-Shop â€” Telegram Commerce & Marketplace Platform
1. What weâ€™re building

TG-Shop is a Telegram-based commerce platform that allows anyone to buy, sell, and discover products entirely within Telegram.
It combines:

a Mini App (WebApp) â€” a rich interface for shops and customers,

a Telegram Bot â€” for onboarding, notifications, and chat actions,

a multi-tenant backend â€” for managing data across all shops.

The platform supports two layers:

Private or Local Shops â€“ owned or joined by individual users.

Universal Shop â€“ a global public marketplace.

2. The user roles
ğŸ§‘â€ğŸ’¼ Merchants (shop owners)

Create and manage their own shop from Telegram.

Add and update products, descriptions, prices, and photos.

Decide whether to publish products only inside their shop or also on the Universal Shop for global visibility.

Manage orders, stock, and communication with buyers.

ğŸ§‘ Buyers (regular Telegram users)

Each buyer has their own shop dashboard in the mini app.
Even if they havenâ€™t created a shop, they will see:

Universal Shop â€“ a global marketplace open to everyone.

Shops theyâ€™ve joined by invitation â€“ e.g. a friendâ€™s or a local sellerâ€™s shop they were added to or invited by.

They can open and browse these shops separately:

â€œUniversal Shopâ€ â†’ all public listings (no checkout, just contact sellers).

â€œJoined Shopsâ€ â†’ private or local shops they were invited to, where they can buy, add to cart, and check out.

ğŸ§‘â€ğŸ”§ Admins (platform operators)

Manage tenants (shops), handle abuse, and approve listings.

Track metrics like orders, leads, and active tenants.

Control platform-wide settings and categories.

3. The two selling modes
ğŸ…°ï¸ Local (Private) Shops

Each merchant owns a private store.

Customers can:

View products,

Add to cart,

Checkout and pay (future: Telebirr/Stripe integration),

Track orders.

The full e-commerce flow is supported.

The merchant sees and manages orders and inventory per shop.

ğŸ…±ï¸ Universal Shop

A shared, global marketplace of all public products.

Everyone can browse products from all shops.

Instead of checkout, buyers can:

Message the seller directly in Telegram, or

Call the seller using the merchantâ€™s public phone number.

Itâ€™s a lead-generation space â€” no payments here.

Each click (â€œmessageâ€ or â€œcallâ€) is logged for analytics as a Contact Intent.

4. User experience inside the Mini App

When a user opens the mini app:

They see a Shop List view with:

â€œğŸŒ Universal Shopâ€

â€œğŸ›’ My Shopsâ€ (if they are a merchant)

â€œğŸ¤ Joined Shopsâ€ (shops they were invited to)

They can open any shop separately.

Inside each shop:

Local shops show â€œAdd to Cartâ€ and â€œBuyâ€ options.

Universal shop shows â€œMessage Sellerâ€ or â€œCall Sellerâ€.

This structure keeps the userâ€™s role clear:

Universal Shop â†’ discover all products.

Joined Shop â†’ participate in private/local shops.

Owned Shop â†’ manage and sell your own items.

5. Communication between buyers and sellers

â€œMessage Sellerâ€ opens a Telegram deep link to the sellerâ€™s bot.

â€œCall Sellerâ€ uses the merchantâ€™s public phone number.

Messages can be:

Direct (buyer messages the seller), or

Relayed through the platform bot (for privacy).

Contact actions are logged to track engagement and prevent spam.

6. Shop membership & invitations

Merchants can invite users to join their shop as customers, helpers, or collaborators.

Each invited user sees that shop appear automatically in their â€œJoined Shopsâ€ list inside the mini app.

Invitations are sent via bot links (/join_<shopId>).

Joined users can:

Browse that shopâ€™s private catalog,

Order from it,

Or message the merchant directly.

This allows private groups (e.g., community markets or small resellers) to operate within Telegram without exposing everything publicly.

7. What the MVP will deliver

âœ… For merchants

Create a shop, add products, manage stock, toggle visibility (local/universal).

See orders and buyer contact intents.

Optionally publish items globally.

âœ… For buyers

See their â€œShop Listâ€ (Universal + joined shops).

Browse, order (in joined/local shops), or contact (in universal).

Manage profile and addresses.

âœ… For admins

Manage all tenants, categories, and product visibility.

View analytics for orders and contacts.

8. Future expansion roadmap

After the Universal Shop and multi-shop access are stable:

Add per-tenant Telegram bots â€” each shop can have its own bot.

Add encrypted bot token storage (secure, per shop).

Support multi-bot webhook routing on one backend.

Add merchant subscriptions and billing (Plan model).

Enable in-app payments (Telebirr, Stripe, Chapa).

Launch analytics dashboard and admin web panel.

ğŸ’¡ In summary

TG-Shop is evolving into a Telegram-native multi-shop ecosystem where:

Every user has access to Universal Shop (public)

And Joined Shops (private or local)

Merchants can run their own shop,

Buyers can explore, buy, or message sellers â€” all inside Telegram,

And the platform grows into a complete marketplace + mini-app network.